{
  "name": "GoHighLevel - Automa√ß√£o de Agendamentos",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "ghl-appointment-webhook",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-appointment",
      "name": "Webhook - Agendamentos GHL",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 300],
      "webhookId": "ghl-webhook-appointment"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.type}}",
              "operation": "equal",
              "value2": "AppointmentCreate"
            }
          ]
        }
      },
      "id": "if-appointment-create",
      "name": "Novo Agendamento?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [460, 200]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.type}}",
              "operation": "equal",
              "value2": "AppointmentUpdate"
            }
          ]
        }
      },
      "id": "if-appointment-update",
      "name": "Agendamento Atualizado?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [460, 400]
    },
    {
      "parameters": {
        "authentication": "headerAuth",
        "requestMethod": "GET",
        "url": "https://services.leadconnectorhq.com/contacts/{{$json.appointment.contactId}}",
        "options": {}
      },
      "id": "get-contact-details",
      "name": "Buscar Detalhes do Contato",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [680, 300],
      "credentials": {
        "httpHeaderAuth": {
          "id": "ghl-api-credentials",
          "name": "GoHighLevel API"
        }
      }
    },
    {
      "parameters": {
        "authentication": "headerAuth",
        "requestMethod": "POST",
        "url": "https://services.leadconnectorhq.com/conversations/messages",
        "jsonParameters": true,
        "bodyParametersJson": "={\"type\": \"SMS\", \"contactId\": \"{{$json.appointment.contactId}}\", \"message\": \"‚úÖ Agendamento confirmado!\\n\\nüìÖ Data: {{DateTime.fromISO($json.appointment.startTime).toFormat('dd/MM/yyyy')}}\\nüïê Hor√°rio: {{DateTime.fromISO($json.appointment.startTime).toFormat('HH:mm')}}\\nüìç Local: {{$json.appointment.address || 'Online'}}\\n\\nOl√° {{$node[\"get-contact-details\"].json[\"contact\"][\"firstName\"]}}, seu agendamento foi confirmado! Aguardamos voc√™. üòä\"}",
        "options": {}
      },
      "id": "send-confirmation-sms",
      "name": "Enviar SMS de Confirma√ß√£o",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [900, 200],
      "credentials": {
        "httpHeaderAuth": {
          "id": "ghl-api-credentials",
          "name": "GoHighLevel API"
        }
      }
    },
    {
      "parameters": {
        "authentication": "headerAuth",
        "requestMethod": "POST",
        "url": "https://services.leadconnectorhq.com/conversations/messages",
        "jsonParameters": true,
        "bodyParametersJson": "={\"type\": \"Email\", \"contactId\": \"{{$json.appointment.contactId}}\", \"subject\": \"Confirma√ß√£o de Agendamento - {{DateTime.fromISO($json.appointment.startTime).toFormat('dd/MM/yyyy HH:mm')}}\", \"html\": \"<h2>üéâ Agendamento Confirmado!</h2><p>Ol√° <strong>{{$node[\"get-contact-details\"].json[\"contact\"][\"firstName\"]}}</strong>,</p><p>Seu agendamento foi confirmado com sucesso!</p><div style='background: #f5f5f5; padding: 15px; border-radius: 8px; margin: 20px 0;'><h3>üìã Detalhes do Agendamento:</h3><p><strong>üìÖ Data:</strong> {{DateTime.fromISO($json.appointment.startTime).toFormat('dd/MM/yyyy')}}</p><p><strong>üïê Hor√°rio:</strong> {{DateTime.fromISO($json.appointment.startTime).toFormat('HH:mm')}} √†s {{DateTime.fromISO($json.appointment.endTime).toFormat('HH:mm')}}</p><p><strong>üìç Local:</strong> {{$json.appointment.address || 'Reuni√£o Online'}}</p><p><strong>üìù Assunto:</strong> {{$json.appointment.title}}</p></div><p>Aguardamos voc√™! Se precisar remarcar ou cancelar, entre em contato conosco.</p><p>Atenciosamente,<br>Equipe de Atendimento</p>\"}",
        "options": {}
      },
      "id": "send-confirmation-email",
      "name": "Enviar Email de Confirma√ß√£o",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [900, 100],
      "credentials": {
        "httpHeaderAuth": {
          "id": "ghl-api-credentials",
          "name": "GoHighLevel API"
        }
      }
    },
    {
      "parameters": {
        "chatId": "{{ $vars.TELEGRAM_CHAT_ID }}",
        "text": "üìÖ *NOVO AGENDAMENTO*\n\nüë§ *Cliente:* {{$node[\"get-contact-details\"].json[\"contact\"][\"firstName\"]}} {{$node[\"get-contact-details\"].json[\"contact\"][\"lastName\"]}}\nüìß *Email:* {{$node[\"get-contact-details\"].json[\"contact\"][\"email\"]}}\nüìû *Telefone:* {{$node[\"get-contact-details\"].json[\"contact\"][\"phone\"]}}\n\nüìÖ *Data:* {{DateTime.fromISO($json.appointment.startTime).toFormat('dd/MM/yyyy')}}\nüïê *Hor√°rio:* {{DateTime.fromISO($json.appointment.startTime).toFormat('HH:mm')}} √†s {{DateTime.fromISO($json.appointment.endTime).toFormat('HH:mm')}}\nüìù *Assunto:* {{$json.appointment.title}}\nüìç *Local:* {{$json.appointment.address || 'Online'}}\n\nConfirma√ß√£o autom√°tica enviada! ‚úÖ",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "id": "telegram-appointment-notification",
      "name": "Notificar Telegram - Novo Agendamento",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [1120, 200],
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot-credentials",
          "name": "Telegram Bot API"
        }
      }
    },
    {
      "parameters": {
        "authentication": "headerAuth",
        "requestMethod": "POST",
        "url": "https://services.leadconnectorhq.com/conversations/messages",
        "jsonParameters": true,
        "bodyParametersJson": "={\"type\": \"SMS\", \"contactId\": \"{{$json.appointment.contactId}}\", \"message\": \"üîÑ Agendamento atualizado!\\n\\nüìÖ Nova data: {{DateTime.fromISO($json.appointment.startTime).toFormat('dd/MM/yyyy')}}\\nüïê Novo hor√°rio: {{DateTime.fromISO($json.appointment.startTime).toFormat('HH:mm')}}\\n\\nOl√° {{$node[\"get-contact-details\"].json[\"contact\"][\"firstName\"]}}, seu agendamento foi alterado. Confirme se est√° ok! üìû\"}",
        "options": {}
      },
      "id": "send-update-sms",
      "name": "Enviar SMS de Atualiza√ß√£o",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [900, 400],
      "credentials": {
        "httpHeaderAuth": {
          "id": "ghl-api-credentials",
          "name": "GoHighLevel API"
        }
      }
    },
    {
      "parameters": {
        "chatId": "{{ $vars.TELEGRAM_CHAT_ID }}",
        "text": "üîÑ *AGENDAMENTO ATUALIZADO*\n\nüë§ *Cliente:* {{$node[\"get-contact-details\"].json[\"contact\"][\"firstName\"]}} {{$node[\"get-contact-details\"].json[\"contact\"][\"lastName\"]}}\nüìß *Email:* {{$node[\"get-contact-details\"].json[\"contact\"][\"email\"]}}\n\nüìÖ *Nova Data:* {{DateTime.fromISO($json.appointment.startTime).toFormat('dd/MM/yyyy')}}\nüïê *Novo Hor√°rio:* {{DateTime.fromISO($json.appointment.startTime).toFormat('HH:mm')}} √†s {{DateTime.fromISO($json.appointment.endTime).toFormat('HH:mm')}}\nüìù *Assunto:* {{$json.appointment.title}}\n\nNotifica√ß√£o de altera√ß√£o enviada ao cliente! üì±",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "id": "telegram-update-notification",
      "name": "Notificar Telegram - Agendamento Atualizado",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [1120, 400],
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot-credentials",
          "name": "Telegram Bot API"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 10 * * *"
            }
          ]
        }
      },
      "id": "daily-reminder-trigger",
      "name": "Trigger - Lembretes Di√°rios",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [240, 600]
    },
    {
      "parameters": {
        "authentication": "headerAuth",
        "requestMethod": "GET",
        "url": "https://services.leadconnectorhq.com/appointments/",
        "qs": {
          "locationId": "={{$vars.GHL_LOCATION_ID}}",
          "startDate": "={{DateTime.now().plus({days: 1}).toISODate()}}",
          "endDate": "={{DateTime.now().plus({days: 1}).toISODate()}}"
        },
        "options": {}
      },
      "id": "get-tomorrow-appointments",
      "name": "Buscar Agendamentos de Amanh√£",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [460, 600],
      "credentials": {
        "httpHeaderAuth": {
          "id": "ghl-api-credentials",
          "name": "GoHighLevel API"
        }
      }
    },
    {
      "parameters": {
        "splitIntoItems": true,
        "fieldToSplitOut": "events",
        "options": {}
      },
      "id": "split-appointments",
      "name": "Dividir Agendamentos",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [680, 600]
    },
    {
      "parameters": {
        "authentication": "headerAuth",
        "requestMethod": "GET",
        "url": "https://services.leadconnectorhq.com/contacts/{{$json.contactId}}",
        "options": {}
      },
      "id": "get-contact-for-reminder",
      "name": "Buscar Contato para Lembrete",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [900, 600],
      "credentials": {
        "httpHeaderAuth": {
          "id": "ghl-api-credentials",
          "name": "GoHighLevel API"
        }
      }
    },
    {
      "parameters": {
        "authentication": "headerAuth",
        "requestMethod": "POST",
        "url": "https://services.leadconnectorhq.com/conversations/messages",
        "jsonParameters": true,
        "bodyParametersJson": "={\"type\": \"SMS\", \"contactId\": \"{{$json.contactId}}\", \"message\": \"‚è∞ Lembrete: Voc√™ tem um agendamento amanh√£!\\n\\nüìÖ Data: {{DateTime.fromISO($node[\"split-appointments\"].json.startTime).toFormat('dd/MM/yyyy')}}\\nüïê Hor√°rio: {{DateTime.fromISO($node[\"split-appointments\"].json.startTime).toFormat('HH:mm')}}\\nüìù Assunto: {{$node[\"split-appointments\"].json.title}}\\n\\nOl√° {{$node[\"get-contact-for-reminder\"].json[\"contact\"][\"firstName\"]}}, n√£o esque√ßa! Aguardamos voc√™. üòä\"}",
        "options": {}
      },
      "id": "send-reminder-sms",
      "name": "Enviar SMS de Lembrete",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1120, 600],
      "credentials": {
        "httpHeaderAuth": {
          "id": "ghl-api-credentials",
          "name": "GoHighLevel API"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{\"status\": \"success\", \"message\": \"Agendamento processado com sucesso\", \"timestamp\": \"{{$now}}\"}",
        "options": {}
      },
      "id": "webhook-response",
      "name": "Resposta Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1340, 300]
    }
  ],
  "connections": {
    "Webhook - Agendamentos GHL": {
      "main": [
        [
          {
            "node": "Novo Agendamento?",
            "type": "main",
            "index": 0
          },
          {
            "node": "Agendamento Atualizado?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Novo Agendamento?": {
      "main": [
        [
          {
            "node": "Buscar Detalhes do Contato",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agendamento Atualizado?": {
      "main": [
        [
          {
            "node": "Buscar Detalhes do Contato",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Detalhes do Contato": {
      "main": [
        [
          {
            "node": "Enviar Email de Confirma√ß√£o",
            "type": "main",
            "index": 0
          },
          {
            "node": "Enviar SMS de Confirma√ß√£o",
            "type": "main",
            "index": 0
          },
          {
            "node": "Enviar SMS de Atualiza√ß√£o",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar SMS de Confirma√ß√£o": {
      "main": [
        [
          {
            "node": "Notificar Telegram - Novo Agendamento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar Email de Confirma√ß√£o": {
      "main": [
        [
          {
            "node": "Notificar Telegram - Novo Agendamento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notificar Telegram - Novo Agendamento": {
      "main": [
        [
          {
            "node": "Resposta Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar SMS de Atualiza√ß√£o": {
      "main": [
        [
          {
            "node": "Notificar Telegram - Agendamento Atualizado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notificar Telegram - Agendamento Atualizado": {
      "main": [
        [
          {
            "node": "Resposta Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Trigger - Lembretes Di√°rios": {
      "main": [
        [
          {
            "node": "Buscar Agendamentos de Amanh√£",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Agendamentos de Amanh√£": {
      "main": [
        [
          {
            "node": "Dividir Agendamentos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dividir Agendamentos": {
      "main": [
        [
          {
            "node": "Buscar Contato para Lembrete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Contato para Lembrete": {
      "main": [
        [
          {
            "node": "Enviar SMS de Lembrete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-09-15T11:00:00.000Z",
  "id": "ghl-appointment-automation",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "tags": [
    {
      "createdAt": "2025-09-15T11:00:00.000Z",
      "id": "gohighlevel",
      "name": "gohighlevel",
      "updatedAt": "2025-09-15T11:00:00.000Z"
    }
  ],
  "updatedAt": "2025-09-15T11:00:00.000Z",
  "versionId": "1"
}